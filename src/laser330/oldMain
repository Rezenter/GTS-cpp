#include <iostream>
#include "Control.h"
#include "version.h"


int main() {
    std::cout << "1064 Driver Version:" << VERSION << std::endl;
    Chatter chatter;
    Control laser(chatter);

    std::cout << "\nx = eXit" << std::endl;
    std::cout << "c = Control (grab/release remote control)" << std::endl;
    std::cout << "i = Idle (state 2, thermostabilisation)" << std::endl;
    std::cout << "r = Ready (state 3, desync mode)" << std::endl;
    std::cout << "f = Fire (state 4, generation)\n" << std::endl;
    bool remote = false;
    char input;
    while(!laser.exit){
        std::cin>>input;
        switch (input) {
            case 'x':
                std::cout << "exit requested." << std::endl;
                laser.exit = true;
                sleep(1);
                break;
            case 'c':
                std::cout << "Control switch requested." << std::endl;
                if(laser.remoteControl(!remote)){
                    remote = !remote;
                }
                break;
            case 'i':
                std::cout << "Idle state requested." << std::endl;
                laser.setState(Control::idle);
                break;
            case 'r':
                std::cout << "Ready state requested." << std::endl;
                laser.setState(Control::readyToShoot);
                break;
            case 'f':
                std::cout << "Shooting state requested." << std::endl;
                laser.setState(Control::shooting);
                break;
            default:
                break;
        }
    };
    std::cout << "\n\n Input anything to exit." << std::endl;
    std::cin >> input;
    return 0;
}
